### MSAA多重采样抗锯齿

顶点到片段过程中，首先是有三个顶点，每个像素的中心包含有一个采样点，在每一个采样点被遮住的像素处都会生成一个片段。由于屏幕像素总量的限制，有些边缘的像素能够被渲染出来，而有些则不会。因此导致了锯齿的出现。

![image-20250601122926079](C:\Users\SOF\Desktop\OpenGL笔记\assets\image-20250601122926079.png)

![image-20250601122933853](C:\Users\SOF\Desktop\OpenGL笔记\assets\image-20250601122933853.png)

MSAA将单一的采样点变为多个采样点，子采样点个数越多显然精度越高

![image-20250601123537356](C:\Users\SOF\Desktop\OpenGL笔记\assets\image-20250601123537356.png)

一种显而易见的方法是，对每个被遮盖住的子采样点运行一次片段着色器，最后将每个像素所有子采样点的颜色平均一下。然而实际上需要运行多次的片段着色器，会显著地降低性能。

无论三角形遮盖了多少个子采样点，（每个图元中）每个像素只运行**一次**片段着色器。片段着色器使用插值到像素**中心**的顶点数据，然后，MSAA使用更大的深度/模板缓冲区来确定子采样点的覆盖率。被覆盖的子采样点数量将决定了像素颜色对帧缓冲的影响程度。因为上图的4个采样点中只有2个被遮盖住了，所以三角形的颜色会有一半与帧缓冲区的颜色（在这里是无色）进行混合，最终形成一种淡蓝色。

![image-20250601125349199](C:\Users\SOF\Desktop\OpenGL笔记\assets\image-20250601125349199.png)

对深度测试来说，在运行深度测试之前，每个顶点的深度值会被插值到各个子样本中。

而对模板测试来说，我们会为每个子样本存储模板值，这意味着缓冲区的大小会根据每个像素的子采样点数量而相应增加。